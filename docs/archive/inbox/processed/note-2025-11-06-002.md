# Note 2025-11-06-002: Story 3.1-3.5 未涵蓋測試項目與優化建議

**建立日期**: 2025-11-06  
**狀態**: ✅ converted  
**類型**: Optimization / Bug  
**相關 Run**: run-2025-11-06-01

---

## 未涵蓋的測試項目（未來需要補驗證）

### Story 3.1 User Test 未涵蓋項目
- [ ] **Session 過期測試**：等待 Session 過期後，驗證 Token 是否失效
- [ ] **Token 過期測試**：等待 Token 過期後，驗證 API 是否返回 401
- [ ] **並發登入測試**：同一帳號在不同裝置/瀏覽器登入，驗證 Session 管理

### Story 3.2 User Test 未涵蓋項目
- [ ] **Admin API 端點保護測試**：使用 handle 的 Admin API 端點（如 `/api/stores/:handle/info`）的權限驗證
- [ ] **跨使用者資料存取測試（詳細）**：測試所有 API 端點的資料隔離

### Story 3.3 User Test 未涵蓋項目
- [ ] **Webhook 事件隔離測試（詳細）**：測試 Webhook 事件的完整隔離機制
- [ ] **資料遷移測試**：測試從舊資料結構遷移到新結構的完整流程

### Story 3.4 User Test 未涵蓋項目
- [ ] **前端路由保護測試（詳細）**：測試所有需要保護的頁面
- [ ] **Token 自動附加測試（詳細）**：測試所有 API 請求的 Token 附加機制
- [ ] **登入狀態持久化測試**：測試頁面重新載入後，登入狀態是否保持

### Story 3.5 User Test 未涵蓋項目
- [ ] **多商店授權測試**：同一使用者授權多個商店，驗證資料隔離
- [ ] **OAuth 回調失敗處理測試**：測試 OAuth 回調失敗時的錯誤處理
- [ ] **跨使用者商店授權測試**：測試不同使用者授權相同 handle 的商店

---

## 觀察到的問題（未來優化）

### 1. 註冊流程防呆機制不完整
**問題描述**：
- 嘗試註冊已存在的 email 會直接報 400 錯誤
- 沒有友善的錯誤訊息提示使用者
- 沒有前端驗證機制（例如：註冊前檢查 email 是否已存在）

**影響範圍**：
- 使用者體驗不佳
- 錯誤訊息不夠明確

**建議處理方式**：
- 後端返回更友善的錯誤訊息（例如：「此 Email 已被註冊，請使用其他 Email 或直接登入」）
- 前端加入 Email 格式驗證和重複檢查（可選：註冊前先檢查 email 是否已存在）
- 前端顯示友善的錯誤訊息

**優先級**：Medium  
**類型**：Optimization

---

### 2. 前後端 state 控管不順暢
**問題描述**：
- 已經登出後，登入另一個帳戶時，會閃過幾秒鐘舊帳戶的資料才清空
- 可能是前端 state 更新時機問題，或後端 Session 清除時機問題

**影響範圍**：
- 使用者體驗不佳（看到錯誤的資料）
- 可能造成資料混淆

**建議處理方式**：
- 檢查登出時的前端 state 清除邏輯
- 檢查登入時的前端 state 更新邏輯
- 確保登出時立即清除所有相關 state（包括 localStorage、Zustand store）
- 確保登入時立即更新 state，避免顯示舊資料

**優先級**：Medium  
**類型**：Bug / Optimization

---

## 後續處理（整理）

- [x] 已整理
- [x] 轉換為：Epic 4 Stories 的測試與 UX 要求（Story 4.2、4.4、4.5 驗收）
- [x] 相關文件：`docs/backlog/epics/epic-4-multi-store-management.md`

---

**轉換日期**: 2025-11-07


